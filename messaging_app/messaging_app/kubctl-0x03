#!/bin/bash

# Apply the updated deployment (rolling update)
echo "ğŸš€ Applying rolling update..."
kubectl apply -f messaging_app/blue_deployment.yaml

# Monitor the rollout status
echo "ğŸ”„ Monitoring rollout..."
kubectl rollout status deployment/blue-deployment

# Test availability during rollout
echo "ğŸ“¡ Testing app availability..."
for i in {1..20}; do
  curl -s http://$(minikube ip):30000/ || echo "âŒ Request failed"
  sleep 1
done

# Verify the current pods after update
echo "âœ… Current Pods:"
kubectl get pods -o wide
